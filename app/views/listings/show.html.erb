<% if @listing.status == true %>
  <h1>DEAL HAS BEEEN DONE </h1>
    <%= render 'listing' %>
    
<% else %>
  <h1>DEAL STILL THERE </h1>
  <%= render 'listing' %>

    <% if (user_signed_in? && current_user.id == @listing.user_id)%>
      <div class="listing-edit-button">
        <%= link_to "Edit #{@listing.title}", edit_listing_path %>
      </div>
    <% end %>

    <% if (user_signed_in? && current_user.id == @listing.user_id) %>
      <div class="listing-delete-button">
        <%= link_to "Destroy #{@listing.title}", @listing,
                  method: :delete,
                  data: { confirm: 'Are you sure you want to delete ' + @listing.title } %>
      </div>
    <% end %>

    <h1>MAKE YOUR BETS </h1> 

<% end %>

<br>

<div class="lenders-offers">
  <h1>Offers</h1>
  
  <% if user_signed_in? %>
    <% @listing.offers.each do |offer| %>

      <% if offer.status == true %>
        <h1>Accepted Offer</h1>
        <div class="offer-id">
          <p>Offer number: <%= offer.id %></p>
        </div>

        <div class="offer-posted-at">
          <p>Posted at: <%= offer.created_at %></p>
        </div>

        <div class="offer-updated-at">
          <p>Updated at: <%= offer.updated_at %></p>
        </div> 
        <strong>Lender Name:</strong>
        <%= offer.user.name %>
      </p>
      
      <p>
        <strong>Interest:</strong>
        <%= offer.interest %> %
      </p>
      
      <p>
        <strong>Interest amount:</strong>
        AU<%=  number_to_currency(@listing.amount * (offer.interest/100) * offer.months / 12)%>
      </p>
      
      <p>
        <strong>Term:</strong>
        <%= offer.months %> months
      </p>

      <p>
        <strong>Comment:</strong>
        <%= offer.description %>
      </p>
      <% @amount =  @listing.amount * offer.interest * offer.months / 12 %>
      <% end %>

      <br>

      <% if offer.status == false && @listing.status == false %>
        <h1>Pending Offer by <%= offer.user.name %></h1>
              <div class="offer-id">
          <p>Offer number: <%= offer.id %></p>
        </div>

        <div class="offer-posted-at">
          <p>Posted at: <%= offer.created_at %></p>
        </div>

        <div class="offer-updated-at">
          <p>Updated at: <%= offer.updated_at %></p>
        </div>

        <p>  
          <strong>Lender Name:</strong>
          <%= offer.user.name %>
        </p>
        
        <p>
          <strong>Interest rate:</strong>
          <%= offer.interest %> %
        </p>
        
        <p>
          <strong>Lending term:</strong>
          <%= offer.months %> months
        </p>
        
        <p>
          <strong>Interest amount :</strong>
          AU<%=  number_to_currency(@listing.amount * (offer.interest/100) * offer.months / 12)%>
        </p>

        <p>
          <strong>Comment:</strong>
          <%= offer.description %>
        </p>
        <% if current_user.user_type == true && current_user.id == @listing.user_id && @listing.status == false %> 
          <% @amount =  @listing.amount * offer.interest * offer.months / 12 %>
          <%= render "layouts/shared/stripe_form", amount: @amount, offer_id: offer.id %>
        <% end %>

      <% elsif offer.status == false && @listing.status == true %>
        <h1>Rejected Offer by <%= @listing.user.name %></h1>
        <div class="offer-id">
          <p>Offer number: <%= offer.id %></p>
        </div>

        <div class="offer-posted-at">
          <p>Posted at: <%= offer.created_at %></p>
        </div>

        <div class="offer-updated-at">
          <p>Updated at: <%= offer.updated_at %></p>
        </div>

        <p>  
          <strong>Lender Name:</strong>
          <%= offer.user.name %>
        </p>
      
        <p>
          <strong>Interest rate:</strong>
          <%= offer.interest %> %
        </p>
      
        <p>
          <strong>Lending term:</strong>
          <%= offer.months %> months
        </p>
      
        <p>
          <strong>Interest amount :</strong>
          AU<%=  number_to_currency(@listing.amount * (offer.interest/100) * offer.months / 12)%>
        </p>

        <p>
          <strong>Comment:</strong>
          <%= offer.description %>
        </p>
        <% if current_user.user_type == true && current_user.id == @listing.user_id && @listing.status == false %> 
          <% @amount =  @listing.amount * offer.interest * offer.months / 12 %>
          <%= render "layouts/shared/stripe_form", amount: @amount, offer_id: offer.id %>
        <% end %>
      <% end %>
    <% end %>
    
    <% if current_user.user_type != true && current_user.id != @listing.user_id && @listing.status == false %>  
      <h2>Add your offer:</h2>
      <%= render 'offers/form' %>
    <% end %>
  <% else %>
    <h2>You can see/add your offers after you <%= link_to 'Sign Up', new_user_registration_path %> / <%= link_to 'Log in', new_user_session_path %>.</h2>
  <% end %> 
</div>




<%= link_to 'Back', listings_path %>